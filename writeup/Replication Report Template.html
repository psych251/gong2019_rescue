<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raphael Uricher (Email: ruricher@stanford.edu)">
<meta name="dcterms.date" content="2024-03-26">

<title>Replication of ‘Are Older Adults More Willing to Donate? The Roles of Donation Form and Social Relationship’ by Gong, Zhang &amp; Fung (2019, The Journals of Gerontology: Series B)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Replication Report Template_files/libs/clipboard/clipboard.min.js"></script>
<script src="Replication Report Template_files/libs/quarto-html/quarto.js"></script>
<script src="Replication Report Template_files/libs/quarto-html/popper.min.js"></script>
<script src="Replication Report Template_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Replication Report Template_files/libs/quarto-html/anchor.min.js"></script>
<link href="Replication Report Template_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Replication Report Template_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Replication Report Template_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Replication Report Template_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Replication Report Template_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#summary-of-prior-replication-attempt" id="toc-summary-of-prior-replication-attempt" class="nav-link" data-scroll-target="#summary-of-prior-replication-attempt">Summary of prior replication attempt</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#power-analysis" id="toc-power-analysis" class="nav-link" data-scroll-target="#power-analysis">Power Analysis</a></li>
  <li><a href="#planned-sample" id="toc-planned-sample" class="nav-link" data-scroll-target="#planned-sample">Planned Sample</a></li>
  <li><a href="#materials" id="toc-materials" class="nav-link" data-scroll-target="#materials">Materials</a></li>
  <li><a href="#procedure" id="toc-procedure" class="nav-link" data-scroll-target="#procedure">Procedure</a></li>
  <li><a href="#controls" id="toc-controls" class="nav-link" data-scroll-target="#controls">Controls</a></li>
  <li><a href="#analysis-plan" id="toc-analysis-plan" class="nav-link" data-scroll-target="#analysis-plan">Analysis Plan</a></li>
  <li><a href="#differences-from-original-study-and-1st-replication" id="toc-differences-from-original-study-and-1st-replication" class="nav-link" data-scroll-target="#differences-from-original-study-and-1st-replication">Differences from Original Study and 1st replication</a></li>
  <li><a href="#methods-addendum-post-data-collection" id="toc-methods-addendum-post-data-collection" class="nav-link" data-scroll-target="#methods-addendum-post-data-collection">Methods Addendum (Post Data Collection)</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation</a></li>
  <li><a href="#confirmatory-analysis" id="toc-confirmatory-analysis" class="nav-link" data-scroll-target="#confirmatory-analysis">Confirmatory analysis</a></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation">Visualisation</a></li>
  <li><a href="#exploratory-analyses" id="toc-exploratory-analyses" class="nav-link" data-scroll-target="#exploratory-analyses">Exploratory analyses</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#mini-meta-analysis" id="toc-mini-meta-analysis" class="nav-link" data-scroll-target="#mini-meta-analysis">Mini meta analysis</a>
  <ul class="collapse">
  <li><a href="#summary-of-replication-attempt" id="toc-summary-of-replication-attempt" class="nav-link" data-scroll-target="#summary-of-replication-attempt">Summary of Replication Attempt</a></li>
  <li><a href="#commentary" id="toc-commentary" class="nav-link" data-scroll-target="#commentary">Commentary</a></li>
  </ul></li>
  <li><a href="#supplementary-image" id="toc-supplementary-image" class="nav-link" data-scroll-target="#supplementary-image">Supplementary Image</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Replication of ‘Are Older Adults More Willing to Donate? The Roles of Donation Form and Social Relationship’ by Gong, Zhang &amp; Fung (2019, The Journals of Gerontology: Series B)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Raphael Uricher (Email: ruricher@stanford.edu) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 26, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<!-- Replication reports should all use this template to standardize reporting across projects.  These reports will be public supplementary materials that accompany the summary report(s) of the aggregate results. -->
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This project revolves around how age shapes people’s willingness to donate time and money to various others. The key research questions the original study was interested in examining were: 1) Do older adults donate more than younger adults? 2) Is age-donation relationship influenced by donation form (money vs time), kinship (relative vs non-relative), and/or social distance (closeness)?</p>
<p>In this experiment, samples of older and younger adults, respectively, respond to a survey containing the following demographic items: gender, age, core social network size (i.e., estimated number of important relatives and friends in their lives), level of education, and household income. They also complete a hypothetical donation task in which they indicate how much money or time they would donate to a number of targets who systematically vary in their closeness to and kinship with the participant. The study uses a mixed design in which <em>age</em> (older vs younger) is a between-subjects variable and <em>donation form</em> (money vs time), <em>kinship with the target</em> (relative vs non-relative), and <em>social distance with the target</em> (targets ranked 1st, 2nd, 5th, 10th, 20th, 50th, and 100th in a list of 100 people ranked in descending order of closeness) are within-subjects variables.</p>
<p>Analysis involves first fitting a hyperbolic discount function to group data and testing for goodness of fit, then fitting a hyperbolic discount function to individual data to find each participant’s discount rate (k) and area under curve (AUC) values. k and AUC values are then log-transformed, and finally submitted to mixed 2 (age) × 2 (donation form) × 2 (kinship) repeated measures ANOVAs, both with and without demographic variables as covariates.</p>
<p><a href="https://github.com/psych251/gong2019_rescue">Github Repository</a></p>
<p><a href="https://github.com/psych251/gong2019_rescue/blob/main/original_paper/gbx099.pdf">Original Paper</a></p>
<p><a href="https://osf.io/c8f7k">Preregistration</a></p>
<p><a href="https://stanforduniversity.qualtrics.com/jfe/form/SV_4Trmek4bc8vVDp4">Link to Qualtrics survey</a></p>
</section>
<section id="summary-of-prior-replication-attempt" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-prior-replication-attempt">Summary of prior replication attempt</h2>
<p>The prior replication attempt was conducted by Yochai Shavit in 2017 and was unable to replicate Gong et al.’s (2019) main findings. However, Shavit’s replication attempt departed from the original study on a number of dimensions. Firstly, the original sample consisted of 89 younger (age range: 18-44, mean: 30.1) and 66 older adults (age range: 60-84, mean: 69.4) from Hong Kong. In the replication attempt, based on a power analysis indicating that data from 45 younger and 45 older adults would be sufficient to detect a main effect of age with 80% power in a one-tailed t-test, 43 younger (age range: 19-35, mean: 28.2) and 47 older (age range: 57-74, mean: 62.7) adults living in the United States were recruited. The samples thus differed in three key ways: the sample in the replication study was smaller, the participants in the replication study were younger, and the samples represented two very different cultures. Of these, Shavit suggests - and I concur - that the factor likely to be most implicated in the failure to replicate is culture, given there are different norms surrounding donation and attitudes towards relatives in Hong Kong and the United States. Additional differences in implementation and analysis were as follows:</p>
<ol type="1">
<li><p>The original study was conducted in person in a lab, whereas the replication study was conducted online. Given the study’s variables essentially consist exclusively of a survey, this seems unlikely to have caused any issues.</p></li>
<li><p>Participants in the original study were asked to imagine they had 100,000 Hong Kong dollars (HKD), whereas participants in the replication study were asked to imagine they had 100,000 US dollars (USD) to fit the context in which the data was collected. 100,000 HKD is approximately equivalent to 13,000 USD. Shavit consulted the first author of the original study about how to reconcile this discrepancy and was told to instruct participants to imagine having 100,000 USD rather than an amount equivalent to 100,000 HKD. Because this study focuses on how much participants are relatively willing to donate to others as a function of how close they are and whether they are related to them, rather than the absolute amount they are willing to donate, I feel there should be minimal issues with this approach.</p></li>
<li><p>In the original study, older participants’ cognitive function was assessed using the cognitive subscale of the Alzheimers’ Disease Assessment Scale (ADAS-Cog) to ensure the results would not be confounded with cognitive function. Because this is not a computer-based test, it was not used in the replication study. This seems unlikely to have been an issue because, in the original study, cognitive function and willingness to donate were not significantly correlated.</p></li>
<li><p>Because the replication study was conducted online, Shavit included a simple attention check and excluded participants who failed it.</p></li>
<li><p>The authors of the original study fit the hyperbolic discount function to the data using Matlab, but Shavit did this using the “optim” function from the ‘stats’ package in R. Shavit was able to obtain similar results to the original authors when testing this procedure a priori using simulated data, suggesting that differences in the results were not an artefact of different software being used for analysis.</p></li>
<li><p>The authors of the original study did not report how they dealt with missing data. In the replication study, Shavit excluded participants with missing AUC values from analysis.</p></li>
<li><p>In the original study, the younger adult group was comprised of participants aged between 18 and 44. Shavit elected to collect data from participants aged between 18 and 35. Additionally, the youngest participant/s in the older adult group in the original study was/were 60, but the youngest participant/s in the older adult group in the replication study was/were 57 because of constraints with regard to participant screening on Mechanical Turk.</p></li>
<li><p>The authors of the original study did not report using any post-hoc correction when conducting t-tests. In the replication study, Shavit reported the results of t-tests both with and without Bonferroni correction.</p></li>
</ol>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="power-analysis" class="level3">
<h3 class="anchored" data-anchor-id="power-analysis">Power Analysis</h3>
<p>It was not possible to conduct one single, definitive power analysis for either the original study or the replication study because GPower requires <em>the correlation between the repeated measures</em> as an input parameter for post-hoc power analyses of ANOVA which include repeated measures and between-subjects factors, and neither the original paper nor the write-up of the replication attempt reported this.</p>
<p>However, for the original study (which had partial eta-squared of 0.05, a total sample size of 155, 2 groups and 4 measurements), observed power would have been at least 0.81 (if the correlation between the measurements was 0.99) and up to over 0.99 (if the correlation between between the measurements was 0.01). It is thus safe to say the original study was sufficiently powered.</p>
<p>In the first replication attempt (which had partial eta-squared of 0.025, a total sample size of 90, and as before, 2 groups and 4 measurements), observed power could have been anywhere between 0.33 (if the correlation between the measurements was 0.99) and 0.84 (if the correlation between between the measurements was 0.01). It was thus likely underpowered.</p>
</section>
<section id="planned-sample" class="level3">
<h3 class="anchored" data-anchor-id="planned-sample">Planned Sample</h3>
<p>Based on the power analyses described above and budgetary constraints, I will collect data from 156 participants (78 for each group), which approximately corresponds to the original study’s sample size.</p>
<p>I will collect data from both a younger sample and an older sample. The author of the replication study suggested that cultural differences may have driven the failure to replicate. I will not be able to collect data specifically from Hong Kong Chinese participants as in the original study due to a dearth of Hong Kong residents actively using Prolific, but I will recruit participants who report their ethnicity as East Asian to try to sample people with more similar cultural backgrounds to the participants in the original study than those who participated in the first replication attempt.</p>
<p>In the original study, younger participants were aged between 18 and 44, and older participants were aged over 60. However, at the time of preparing this report, there were only 30 East Asian workers who were active on Prolific in the past 30 days. This number increased to 73 when minimum age was set to 55 (the lower end of the age distribution for the older group in the first replication attempt), but given this is still smaller than the sample size I aim to collect and it is unlikely all of these workers would participate in the study in any case, I will allow participants as young as 50 to participate as part of the older group. I believe this is justifiable because it seems most plausible that cultural differences drove the failure to replicate in the first replication attempt, so it is arguably pertinent to prioritise recruiting participants of East Asian background rather than participants aged over 55/60 for this rescue project.</p>
</section>
<section id="materials" class="level3">
<h3 class="anchored" data-anchor-id="materials">Materials</h3>
<p>Participants will be asked to list their gender, age, level of education, and household income. As a measure of core social network size, participants will be asked to estimate the number of important friends and family they have in their lives.</p>
<p>Participants will then be asked to complete hypothetical donation tasks for both relatives and non-relatives. The initial instruction will be as follows: “The following task asks you to imagine that you have a list of 100 relatives (non-relatives) arranged in descending order of their closeness with you. The person at position #1 is your closest relative (non-relative), while the person at position #100 is a relative (non-relative) you may know but are not close at all. You do not have to actually create the list – just imagine that you have done so. Next you will be asked to answer questions regarding these relatives (non-relatives) at a given position.”</p>
<p>Participants will then be asked 14 questions regarding how much money and time they would be willing to donate to the relatives and non-relatives at each of the following positions on those lists: 1st, 2nd, 5th, 10th, 20th, 50th, and 100th. The questions will read as follows: “Imagine that the relative (non-relative) at position N on your list is now hospitalized. He/she needs to be accompanied and taken care of in the hospital, as well as a large amount of money to pay for the medical expense. If you now own 100 thousand of US dollars and 100 days of vacation, how much money would you donate to him/her, and how many days would you spend taking care of him/her?”</p>
<p>The only difference between the materials described here and those used in the original study is that participants will be asked to imagine they have 100,000 US dollars rather than 10,000 HK dollars, following the instructions given to the author of the first replication attempt from the first author of the original study.</p>
</section>
<section id="procedure" class="level3">
<h3 class="anchored" data-anchor-id="procedure">Procedure</h3>
<p>Participants will be asked to complete a Qualtrics survey containing the measures described above in the order they appear above.</p>
</section>
<section id="controls" class="level3">
<h3 class="anchored" data-anchor-id="controls">Controls</h3>
<p>Following the first replication attempt, I will include a simple attention check. After participants are asked how much time and money they would be willing to donate to a relative at position 20 on their list, they will also be asked the following question: “In the last question, your answers referred to the participant in position:” with 3, 7, 12, 16, 20, 28, and 42 as answer choices. Participants who do not answer ‘20’ will be excluded from analysis.</p>
</section>
<section id="analysis-plan" class="level3">
<h3 class="anchored" data-anchor-id="analysis-plan">Analysis Plan</h3>
<p>Firstly, identifiable information will be removed from the data set. Next, I will follow the analysis plan outlined in the original study:</p>
<blockquote class="blockquote">
<p>To analyze the donation data, we first modeled the group donation data. For each age × donation form × kinship cell, a hyperbolic discount function (i.e., Equation 1) was fit to the group median values (Jones &amp; Rachlin, 2006; Rachlin &amp; Jones, 2007, 2008) over the seven social distances (N = 1, 2, 5, 10, 20, 50, and 100): <span class="math display">\[v=V/(1+kN)\]</span> where V is the undiscounted reward value, v is the reward value that a person would like to forgo for the benefit for someone at a social distance N, and k is a constant indexing degree of social discounting (i.e., discount rate) across social distances. Following the convention of the literature, group median values instead of mean values were used because such data were usually not normally distributed (e.g., Jones &amp; Rachlin, 2006).</p>
</blockquote>
<blockquote class="blockquote">
<p>The fitting process was conducted by curve fit toolbox of Matlab (version 2015a), where R-square and root-mean-square error (RMSE) were used to assess the goodness of fit. Such a modeling technique has been widely used in the literature on temporal (e.g., Frederick, Loewenstein, &amp; O’Donoghue, 2002) and social discounting (e.g., Jones &amp; Rachlin, 2006). The technique enables us to sketch individuals’ donation willingness across various social distances with simple parameters like discount rate (k) and area under curve (AUC) (e.g., Jones &amp; Rachlin, 2006; Margittai et al., 2015). Discount rate (k) reflects a donor’s social-distance dependent selectivity as to donation willingness—a larger k value indicates a higher level of selectivity, that is, the donor treats socially close and distant recipients more differently. AUC could be used to index the donor’s overall generosity to people independent of social distance, with a larger value indicating a higher level of generosity (Margittai et al., 2015; Strombach et al., 2014).</p>
</blockquote>
<blockquote class="blockquote">
<p>Once the appropriateness of the hyperbolic discount function was confirmed for group data, we then conducted the same fitting process to individual data to get the discount rate (k) and the AUC for each participant under different conditions. Again following the convention of the literature, individual data that did not fit the hyperbolic discount function were excluded from further analyses (Vuchinich &amp; Simpson, 1998). The individuals’ k and AUC values were then normalized by a natural logarithm transformation (e.g., Margittai et al., 2015), and transformed values that exceeded ±3 SDs were treated as outliers.</p>
</blockquote>
<blockquote class="blockquote">
<p>Next, the transformed individual k and AUC values were correlated with demographic variables to preliminarily check the influences of demographic variables on donation willingness. To examine the moderating roles of donation form and kinship in the relation between age and donation willingness, the transformed individual AUC values and k values were submitted respectively to a 2 (age: younger and older) × 2 (donation form: money and time) × 2 (kinship: relatives and nonrelatives) mixed design, repeated measures ANOVA (and post hoc tests), with and without controlling for demographic variables.</p>
</blockquote>
<p>I will depart from the above analysis plan only in that I will use R rather than Matlab to conduct curve fitting and analyse data. Additionally, as in the first replication attempt, I will report the results of t-tests both with and without applying Bonferroni correction.</p>
<p><strong>The key analysis of interest is the mixed design, repeated measures ANOVA of transformed AUC values controlling for demographic variables.</strong> Due to my error, the analysis I pre-registered was an ANOVA of transformed AUC values controlling for <em>gender, number of important family members, and number of important friends</em>. However, upon revisiting the original study and first replication, I found that the demographic variables this analysis controlled for were in fact <em>number of important friends, education, and household income</em>. I report the results of ANOVAs controlling for both sets of covariates below (and there is no change in the significance or direction of any effects regardless of which covariates are controlled for).</p>
</section>
<section id="differences-from-original-study-and-1st-replication" class="level3">
<h3 class="anchored" data-anchor-id="differences-from-original-study-and-1st-replication">Differences from Original Study and 1st replication</h3>
<ol type="1">
<li><p>Data will be collected on Prolific rather than in person (as in the original study) or on Mechanical Turk (as in the first replication attempt). This is unlikely to make a difference to the results because this is a survey study.</p></li>
<li><p>The original study’s participants were Hong Kong Chinese adults living in Hong Kong, whereas the first replication attempt sampled residents of the United States of any ethnicity. Rather than recruiting participants who live in a specific country, I will recruit participants who identify as East Asian to attempt to sample people with a relatively similar cultural background to the original study’s participants. If cultural differences were indeed implicated in the failure to replicate, this strategy may increase the chances of replicating the original study’s findings.</p></li>
</ol>
<p>The replication closeness score for this study rests on how different one considers the differences between the populations to be. The key difference is that the original study collected data from individuals living in Hong Kong, and all participants in the ‘older’ group were over 60. In this replication attempt, participants self-identified as East Asian, and all participants in the ‘older’ group were over 50 (see <em>Actual Sample</em> section below). If one considers this to be a major population difference, this was a <em>far</em> replication. However, given the operalisation of the IV and DV, in addition to the stimuli used for the IV and DV, were the same, if one considers the population differences to be minor, this was a <em>very close</em> replication.</p>
</section>
<section id="methods-addendum-post-data-collection" class="level3">
<h3 class="anchored" data-anchor-id="methods-addendum-post-data-collection">Methods Addendum (Post Data Collection)</h3>
<section id="actual-sample" class="level4">
<h4 class="anchored" data-anchor-id="actual-sample">Actual Sample</h4>
<p>76 younger adults and 76 older adults who were prescreened for age and self-identification as East Asian participated in the study. After excluding participants with NA values for any of the variables used in the main analyses, participants who did not report that they identified as ‘Asian’ on the Qualtrics survey, and participants who failed the attention check, the final sample consisted of 75 younger (age range: 18-44, mean: 28.7) and 62 older adults (age range: 50-72, mean: 55.0) adults.</p>
</section>
<section id="differences-from-pre-data-collection-methods-plan" class="level4">
<h4 class="anchored" data-anchor-id="differences-from-pre-data-collection-methods-plan">Differences from pre-data collection methods plan</h4>
<ol type="1">
<li><p>The analysis pipeline could not tolerate missing values for any variables used in the analysis but I had initially only removed participants with missing values for variables in which missing values arose in the pilot studies. Consequently, I needed to tweak the code slightly to ensure <em>only complete cases</em> were included.</p></li>
<li><p>I added a short chunk of code to <em>calculate the mean and range of age for each of the groups</em>.</p></li>
<li><p>As discussed above, I pre-registered ANOVAs that included the covariates <em>gender, number of important family members, and number of important friends</em>. However, upon revisiting the original study and first replication, I found that the demographic variables the main analyses controlled for were in fact <em>number of important friends, education, and household income</em>. To rectify this error, I report the results of ANOVAs controlling for both sets of covariates below (and there is no change in the significance or direction of any effects regardless of which covariates are controlled for).</p></li>
</ol>
</section>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<p>Load relevant libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effsize)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imager)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metafor)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write function to compute hyperbolic function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>discount <span class="ot">&lt;-</span> <span class="cf">function</span> (V, k, N) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> V <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> k <span class="sc">*</span> N)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(nu)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write function to compute RMSE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_vs_discount <span class="ot">&lt;-</span> <span class="cf">function</span>(V, k, N, amount) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> <span class="fu">discount</span>(V, k, N)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  RMSE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((amount <span class="sc">-</span> nu)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(RMSE)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"psych251_final_data.csv"</span>, <span class="at">header=</span>T)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tail</span>(df, <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove identifying information and extraneous variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="dv">2</span><span class="sc">:-</span><span class="dv">17</span>, <span class="sc">-</span><span class="dv">59</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Add subject IDs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">182</span> <span class="co">#changed to reflect final number of participants</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove participants who failed attention check and TA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, attention_check<span class="sc">==</span><span class="dv">5</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, gender_5_TEXT<span class="sc">!=</span><span class="st">"I AM YOUR TA PLEASE EXCLUDE ME"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Also remove participants who were in the pilot and double check only participants who identified as Asian/Pacific Islander are included (though screening was implemented on Prolific to ensure only workers who identified as East Asian were shown the study advertisement in the first instance)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">StartDate =</span> <span class="fu">as.POSIXct</span>(StartDate, <span class="at">format =</span> <span class="st">"%d/%m/%Y %H:%M"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(StartDate <span class="sc">&gt;=</span> <span class="fu">as.POSIXct</span>(<span class="st">"2023-12-07 15:57:46"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)) <span class="co">#filtering out pilot participants</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ethnicity <span class="sc">==</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Converting critical variables to numeric</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>)]<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(df[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove participants with missing values for key variables used in study</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">filter</span>(df, <span class="fu">complete.cases</span>(rel_1_money, rel_1_time, rel_2_money, rel_2_time, rel_5_money, rel_5_time, rel_10_money, rel_10_time, rel_20_money, rel_20_time, rel_50_money, rel_50_time, rel_100_money, rel_100_time, nonrel_1_money, nonrel_1_time, nonrel_2_money, nonrel_2_time, nonrel_5_money, nonrel_5_time, nonrel_10_money, nonrel_10_time, nonrel_20_money, nonrel_20_time, nonrel_50_money, nonrel_50_time, nonrel_100_money, nonrel_100_time, gender, education, income, important_friends, important_family))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Group participants based on age (create an ‘age group’ column where participants are listed as either ‘younger’ or ‘older’)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df<span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(age <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">"younger"</span>, age <span class="sc">&gt;</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">"older"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_group =</span> <span class="fu">factor</span>(age_group, <span class="at">level =</span> <span class="fu">c</span>(<span class="st">"younger"</span>, <span class="st">"older"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#remove participants who do not fall into designated age groups or who didn't enter an age</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_group))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df<span class="sc">$</span>age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>younger   older 
     74      62 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>demos <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">range_age =</span> <span class="fu">paste</span>(<span class="fu">min</span>(age), <span class="st">"-"</span>, <span class="fu">max</span>(age))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Renaming money and time preference variables so they don’t get caught up in data wrangling</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">easeM =</span> ease_money, <span class="at">easeT =</span> ease_time, <span class="at">MorT =</span> money_or_time) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ease_money, <span class="sc">-</span>ease_time, <span class="sc">-</span>money_or_time)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>easeM <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>easeM)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>easeT <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>easeT)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MorT <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>MorT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Making data set longer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>og_lng<span class="ot">=</span>df<span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(condition, amount, <span class="fu">c</span>(<span class="fu">matches</span>(<span class="st">"_money"</span>),<span class="fu">matches</span>(<span class="st">"_time"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(condition, <span class="fu">c</span>(<span class="st">"kin"</span>, <span class="st">"soc_dist"</span>, <span class="st">"donation"</span>), <span class="st">"_"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(kin, amount)<span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(kinship, amount,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>         rel, nonrel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For each age × donation form × kinship cell, fit hyperbolic discount function (i.e., Equation 1) to group median values over seven social distances (N = 1, 2, 5, 10, 20, 50, and 100)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create df with monetary amounts divided by 1000 for plotting and analyses (to have the same units for time and money donations)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_og2<span class="ot">=</span>df<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">rel_1_money=</span>rel_1_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_2_money=</span>rel_2_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_5_money=</span>rel_5_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_10_money=</span>rel_10_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_20_money=</span>rel_20_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_50_money=</span>rel_50_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_100_money=</span>rel_100_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_1_money=</span>nonrel_1_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_2_money=</span>nonrel_2_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_5_money=</span>nonrel_5_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_10_money=</span>nonrel_10_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_20_money=</span>nonrel_20_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_50_money=</span>nonrel_50_money<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nonrel_100_money=</span>nonrel_100_money<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#long-form this dataframe</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>og_lng2<span class="ot">=</span>df_og2<span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(condition, amount, <span class="fu">c</span>(<span class="fu">matches</span>(<span class="st">"_money"</span>),<span class="fu">matches</span>(<span class="st">"_time"</span>))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(condition, <span class="fu">c</span>(<span class="st">"kin"</span>, <span class="st">"soc_dist"</span>, <span class="st">"donation"</span>), <span class="st">"_"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(kin, amount)<span class="sc">%&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(kinship, amount,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         rel,nonrel)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#make variables numeric</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>og_lng <span class="sc">%&gt;%</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(as.numeric) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   StartDate gender gender_5_TEXT age education income ethnicity
1 1701993540      1            NA  21         2      1         2
2 1701993540      1            NA  30         5      4         2
3 1701993780      1            NA  28         5      3         2
4 1701993480      2            NA  57         4      3         2
5 1701993660      1            NA  35         4      5         2
6 1701993960      2            NA  30         4      4         2
  ethnicity_6_TEXT important_friends important_family attention_check id
1               NA                 0                3               5 29
2               NA                 3                3               5 30
3               NA                 6                4               5 31
4               NA                 1                3               5 32
5               NA                10                4               5 33
6               NA                 5                8               5 34
  age_group easeM easeT MorT soc_dist donation kinship amount
1         1     3     1    2        1       NA      NA  50000
2         1     3     2    1        1       NA      NA  10000
3         1     3     2    2        1       NA      NA  80000
4         2     2     4    1        1       NA      NA  50000
5         1     4     4    1        1       NA      NA  50000
6         1     4     2    1        1       NA      NA  10000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>og_lng2 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(as.numeric) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   StartDate gender gender_5_TEXT age education income ethnicity
1 1701993540      1            NA  21         2      1         2
2 1701993540      1            NA  30         5      4         2
3 1701993780      1            NA  28         5      3         2
4 1701993480      2            NA  57         4      3         2
5 1701993660      1            NA  35         4      5         2
6 1701993960      2            NA  30         4      4         2
  ethnicity_6_TEXT important_friends important_family attention_check id
1               NA                 0                3               5 29
2               NA                 3                3               5 30
3               NA                 6                4               5 31
4               NA                 1                3               5 32
5               NA                10                4               5 33
6               NA                 5                8               5 34
  age_group easeM easeT MorT soc_dist donation kinship amount
1         1     3     1    2        1       NA      NA     50
2         1     3     2    1        1       NA      NA     10
3         1     3     2    2        1       NA      NA     80
4         2     2     4    1        1       NA      NA     50
5         1     4     4    1        1       NA      NA     50
6         1     4     2    1        1       NA      NA     10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create table with original median values</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>med_table<span class="ot">=</span>og_lng<span class="sc">%&gt;%</span><span class="fu">group_by</span>(age_group,kinship,donation,soc_dist)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">med_amnt=</span><span class="fu">median</span>(amount))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create table of median values with the transformed monetary amounts</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>med_table2<span class="ot">=</span>og_lng2<span class="sc">%&gt;%</span><span class="fu">group_by</span>(age_group,kinship,donation,soc_dist)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">med_amnt=</span><span class="fu">median</span>(amount))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#make soc_dist variables numeric</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>med_table <span class="ot">&lt;-</span> <span class="fu">mutate</span>(med_table, <span class="at">soc_dist =</span> <span class="fu">as.numeric</span>(soc_dist))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>med_table2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(med_table2, <span class="at">soc_dist =</span> <span class="fu">as.numeric</span>(soc_dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="8" type="1">
<li>Check goodness of fit using R-square and RMSE</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define dataset</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>d<span class="ot">=</span>med_table2</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create empty vectors to store values</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>age_group<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"character"</span>,<span class="at">length=</span><span class="dv">0</span>); donation<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"character"</span>,<span class="at">length=</span><span class="dv">0</span>); kinship<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"character"</span>,<span class="at">length=</span><span class="dv">0</span>); V_values<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="dv">0</span>); k_values<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="dv">0</span>); RMSE<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="dv">0</span>); </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>R_sq<span class="ot">=</span><span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="dv">0</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#run for each age group, extract values for donation * kinship conditions</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>age_group)){</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  d_money_rel<span class="ot">=</span>d<span class="sc">%&gt;%</span><span class="fu">filter</span>(age_group<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"money"</span>, kinship<span class="sc">==</span><span class="st">"rel"</span>) <span class="co">#-&gt; create temp df to get values from</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  age_group<span class="ot">=</span><span class="fu">c</span>(age_group,i) <span class="co">#-&gt; store the appropriate age group</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  donation<span class="ot">=</span><span class="fu">c</span>(donation, <span class="st">"money"</span>) <span class="co">#-&gt; store the appropriate donation</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  kinship<span class="ot">=</span><span class="fu">c</span>(kinship, <span class="st">"rel"</span>) <span class="co">#-&gt; store the appropriate kinship</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co">#-&gt; define discount wrapper to get V, k, and RMSE values for this                                                      condition</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_money_rel<span class="sc">$</span>soc_dist, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_money_rel<span class="sc">$</span>med_amnt))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  opt1<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>)) <span class="co">#-&gt; run discount_wrapper</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  V_values<span class="ot">=</span><span class="fu">c</span>(V_values,opt1<span class="sc">$</span>par[<span class="dv">1</span>]) <span class="co">#-&gt; store resulting V_value</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  k_values<span class="ot">=</span><span class="fu">c</span>(k_values, opt1<span class="sc">$</span>par[<span class="dv">2</span>]) <span class="co">#-&gt; store resulting k_value</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  RMSE<span class="ot">=</span><span class="fu">c</span>(RMSE, opt1<span class="sc">$</span>value) <span class="co">#-&gt; store resulting RMSE value</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  d_money_rel<span class="sc">$</span>pred<span class="ot">=</span><span class="fu">discount</span>(<span class="at">V =</span> opt1<span class="sc">$</span>par[<span class="dv">1</span>], <span class="at">k =</span> opt1<span class="sc">$</span>par[<span class="dv">2</span>],<span class="at">N =</span> d_money_rel<span class="sc">$</span>soc_dist) <span class="co">#-&gt; store predictions in temp                                                                                          dataset</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  cor1<span class="ot">=</span><span class="fu">cor.test</span>(d_money_rel<span class="sc">$</span>med_amnt, d_money_rel<span class="sc">$</span>pred) <span class="co">#-&gt; run cor.test to get correlation of predictions and data</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  R_sq<span class="ot">=</span><span class="fu">c</span>(R_sq, (cor1<span class="sc">$</span>estimate)<span class="sc">^</span><span class="dv">2</span>) <span class="co">#-&gt; square the estimate (pearson's R) to get R^2.</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  d_money_nonrel<span class="ot">=</span>d<span class="sc">%&gt;%</span><span class="fu">filter</span>(age_group<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"money"</span>, kinship<span class="sc">==</span><span class="st">"nonrel"</span>) <span class="co">#-&gt; do all of this for the next donation                                                                               * Kinship condition</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  age_group<span class="ot">=</span><span class="fu">c</span>(age_group,i)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  donation<span class="ot">=</span><span class="fu">c</span>(donation, <span class="st">"money"</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  kinship<span class="ot">=</span><span class="fu">c</span>(kinship, <span class="st">"nonrel"</span>)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_money_nonrel<span class="sc">$</span>soc_dist, </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_money_nonrel<span class="sc">$</span>med_amnt))</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  opt2<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>))</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  V_values<span class="ot">=</span><span class="fu">c</span>(V_values,opt2<span class="sc">$</span>par[<span class="dv">1</span>])</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  k_values<span class="ot">=</span><span class="fu">c</span>(k_values, opt2<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  RMSE<span class="ot">=</span><span class="fu">c</span>(RMSE, opt2<span class="sc">$</span>value)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  d_money_nonrel<span class="sc">$</span>pred<span class="ot">=</span><span class="fu">discount</span>(<span class="at">V =</span> opt2<span class="sc">$</span>par[<span class="dv">1</span>], <span class="at">k =</span> opt2<span class="sc">$</span>par[<span class="dv">2</span>],<span class="at">N =</span> d_money_nonrel<span class="sc">$</span>soc_dist)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  cor2<span class="ot">=</span><span class="fu">cor.test</span>(d_money_nonrel<span class="sc">$</span>med_amnt, d_money_nonrel<span class="sc">$</span>pred)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  R_sq<span class="ot">=</span><span class="fu">c</span>(R_sq, (cor2<span class="sc">$</span>estimate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  d_time_rel<span class="ot">=</span>d<span class="sc">%&gt;%</span><span class="fu">filter</span>(age_group<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"time"</span>, kinship<span class="sc">==</span><span class="st">"rel"</span>)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  age_group<span class="ot">=</span><span class="fu">c</span>(age_group,i)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  donation<span class="ot">=</span><span class="fu">c</span>(donation, <span class="st">"time"</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  kinship<span class="ot">=</span><span class="fu">c</span>(kinship, <span class="st">"rel"</span>)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_time_rel<span class="sc">$</span>soc_dist, </span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_time_rel<span class="sc">$</span>med_amnt))</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  opt3<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>))</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  V_values<span class="ot">=</span><span class="fu">c</span>(V_values,opt3<span class="sc">$</span>par[<span class="dv">1</span>])</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  k_values<span class="ot">=</span><span class="fu">c</span>(k_values, opt3<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  RMSE<span class="ot">=</span><span class="fu">c</span>(RMSE, opt3<span class="sc">$</span>value)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  d_time_rel<span class="sc">$</span>pred<span class="ot">=</span><span class="fu">discount</span>(<span class="at">V =</span> opt3<span class="sc">$</span>par[<span class="dv">1</span>], <span class="at">k =</span> opt3<span class="sc">$</span>par[<span class="dv">2</span>],<span class="at">N =</span> d_time_rel<span class="sc">$</span>soc_dist)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  cor3<span class="ot">=</span><span class="fu">cor.test</span>(d_time_rel<span class="sc">$</span>med_amnt, d_time_rel<span class="sc">$</span>pred)</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  R_sq<span class="ot">=</span><span class="fu">c</span>(R_sq, (cor3<span class="sc">$</span>estimate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  d_time_nonrel<span class="ot">=</span>d<span class="sc">%&gt;%</span><span class="fu">filter</span>(age_group<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"time"</span>, kinship<span class="sc">==</span><span class="st">"nonrel"</span>)</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  age_group<span class="ot">=</span><span class="fu">c</span>(age_group,i)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  donation<span class="ot">=</span><span class="fu">c</span>(donation, <span class="st">"time"</span>)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>  kinship<span class="ot">=</span><span class="fu">c</span>(kinship, <span class="st">"nonrel"</span>)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_time_nonrel<span class="sc">$</span>soc_dist, </span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_time_nonrel<span class="sc">$</span>med_amnt))</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>  opt4<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>))</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>  V_values<span class="ot">=</span><span class="fu">c</span>(V_values,opt4<span class="sc">$</span>par[<span class="dv">1</span>])</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>  k_values<span class="ot">=</span><span class="fu">c</span>(k_values, opt4<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>  RMSE<span class="ot">=</span><span class="fu">c</span>(RMSE, opt4<span class="sc">$</span>value)</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>  d_time_nonrel<span class="sc">$</span>pred<span class="ot">=</span><span class="fu">discount</span>(<span class="at">V =</span> opt4<span class="sc">$</span>par[<span class="dv">1</span>], <span class="at">k =</span> opt4<span class="sc">$</span>par[<span class="dv">2</span>],<span class="at">N =</span> d_time_nonrel<span class="sc">$</span>soc_dist)</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>  cor4<span class="ot">=</span><span class="fu">cor.test</span>(d_time_nonrel<span class="sc">$</span>med_amnt, d_time_nonrel<span class="sc">$</span>pred)</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>  R_sq<span class="ot">=</span><span class="fu">c</span>(R_sq, (cor4<span class="sc">$</span>estimate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="co">#Add all vectors to one dataset</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>med_smry<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="st">`</span><span class="at">Age group</span><span class="st">`</span><span class="ot">=</span>age_group, <span class="at">Donation=</span>donation, <span class="at">Kinship=</span>kinship, <span class="at">V=</span>V_values, <span class="at">k=</span>k_values, <span class="st">`</span><span class="at">R sqr</span><span class="st">`</span><span class="ot">=</span>R_sq, RMSE), <span class="at">row.names =</span> F)<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">V=</span><span class="fu">as.character</span>(V), <span class="at">k=</span><span class="fu">as.character</span>(k), <span class="st">`</span><span class="at">R sqr</span><span class="st">`</span><span class="ot">=</span><span class="fu">as.character</span>(<span class="st">`</span><span class="at">R sqr</span><span class="st">`</span>), <span class="at">RMSE=</span><span class="fu">as.character</span>(RMSE))<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">V=</span><span class="fu">as.numeric</span>(V), <span class="at">k=</span><span class="fu">as.numeric</span>(k), <span class="st">`</span><span class="at">R sqr</span><span class="st">`</span><span class="ot">=</span><span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">R sqr</span><span class="st">`</span>), <span class="at">RMSE=</span><span class="fu">as.numeric</span>(RMSE))</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(med_smry, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">caption =</span> <span class="st">"Estimated Parameters and Goodness-of-fit Indices of the Hyperbolic Functions, group median values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Estimated Parameters and Goodness-of-fit Indices of the Hyperbolic Functions, group median values</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Age group</th>
<th style="text-align: center;">Donation</th>
<th style="text-align: center;">Kinship</th>
<th style="text-align: center;">V</th>
<th style="text-align: center;">k</th>
<th style="text-align: center;">R sqr</th>
<th style="text-align: center;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">younger</td>
<td style="text-align: center;">money</td>
<td style="text-align: center;">rel</td>
<td style="text-align: center;">87.27</td>
<td style="text-align: center;">1.09</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">2.58</td>
</tr>
<tr class="even">
<td style="text-align: center;">younger</td>
<td style="text-align: center;">money</td>
<td style="text-align: center;">nonrel</td>
<td style="text-align: center;">300.00</td>
<td style="text-align: center;">14.23</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.52</td>
</tr>
<tr class="odd">
<td style="text-align: center;">younger</td>
<td style="text-align: center;">time</td>
<td style="text-align: center;">rel</td>
<td style="text-align: center;">101.08</td>
<td style="text-align: center;">0.62</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">2.84</td>
</tr>
<tr class="even">
<td style="text-align: center;">younger</td>
<td style="text-align: center;">time</td>
<td style="text-align: center;">nonrel</td>
<td style="text-align: center;">64.65</td>
<td style="text-align: center;">1.59</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">0.67</td>
</tr>
<tr class="odd">
<td style="text-align: center;">older</td>
<td style="text-align: center;">money</td>
<td style="text-align: center;">rel</td>
<td style="text-align: center;">117.76</td>
<td style="text-align: center;">1.37</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">2.61</td>
</tr>
<tr class="even">
<td style="text-align: center;">older</td>
<td style="text-align: center;">money</td>
<td style="text-align: center;">nonrel</td>
<td style="text-align: center;">300.00</td>
<td style="text-align: center;">39.21</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: center;">older</td>
<td style="text-align: center;">time</td>
<td style="text-align: center;">rel</td>
<td style="text-align: center;">161.86</td>
<td style="text-align: center;">0.81</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">5.71</td>
</tr>
<tr class="even">
<td style="text-align: center;">older</td>
<td style="text-align: center;">time</td>
<td style="text-align: center;">nonrel</td>
<td style="text-align: center;">56.20</td>
<td style="text-align: center;">1.75</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">0.84</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="9" type="1">
<li>Fit hyperbolic discount function to individual data and calculate k and AUC values for each participant in each condition</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the empty dataframe, in which each participant have 4 rows</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df2<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id=</span><span class="fu">rep</span>(<span class="fu">unique</span>(og_lng2<span class="sc">$</span>id),<span class="dv">4</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group=</span><span class="fu">c</span>(),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender=</span><span class="fu">c</span>(),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">education=</span><span class="fu">c</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">income=</span><span class="fu">c</span>(),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">important_friends=</span><span class="fu">c</span>(),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">important_family=</span><span class="fu">c</span>(),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ethnicity=</span><span class="fu">c</span>(),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">kinship=</span><span class="fu">c</span>(),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">donation=</span><span class="fu">c</span>(),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">k=</span><span class="fu">c</span>(),</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC=</span><span class="fu">c</span>()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Fill in values for demographics (age, age group, gender, education, income, number of important family and friends)</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(df2<span class="sc">$</span>id)){</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  df_sub<span class="ot">=</span><span class="fu">filter</span>(df_og2, id<span class="sc">==</span>i)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'age'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>age</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'age_group'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>age_group</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'gender'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>gender</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'education'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>education</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'income'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>income</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'important_friends'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>important_friends</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'important_family'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>important_family</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'ethnicity'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>ethnicity</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df2<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id=</span><span class="fu">rep</span>(<span class="fu">unique</span>(og_lng2<span class="sc">$</span>id),<span class="dv">4</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group=</span><span class="fu">c</span>(),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender=</span><span class="fu">c</span>(),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">education=</span><span class="fu">c</span>(),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">income=</span><span class="fu">c</span>(),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">important_friends=</span><span class="fu">c</span>(),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">important_family=</span><span class="fu">c</span>(),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ethnicity=</span><span class="fu">c</span>(),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kinship=</span><span class="fu">c</span>(),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">donation=</span><span class="fu">c</span>(),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">k=</span><span class="fu">c</span>(),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC=</span><span class="fu">c</span>()</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Fill in values for demographics</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(df2<span class="sc">$</span>id)){</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  df_sub<span class="ot">=</span><span class="fu">filter</span>(df_og2, id<span class="sc">==</span>i)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'age'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>age</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'age_group'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>age_group</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'gender'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>gender</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'education'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>education</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'income'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>income</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'important_friends'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>important_friends</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'important_family'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>important_family</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'ethnicity'</span>]<span class="ot">=</span>df_sub<span class="sc">$</span>ethnicity</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for each individual, extract values for donation * kinship conditions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#set variable soc_dist in og_lng2 to be numeric</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>og_lng2<span class="sc">$</span>soc_dist<span class="ot">=</span><span class="fu">as.character</span>(og_lng2<span class="sc">$</span>soc_dist)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>og_lng2<span class="sc">$</span>soc_dist<span class="ot">=</span><span class="fu">as.numeric</span>(og_lng2<span class="sc">$</span>soc_dist)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(og_lng2<span class="sc">$</span>soc_dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get length of number of participants (n) as value</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>n_p<span class="ot">=</span><span class="fu">length</span>(<span class="fu">unique</span>(df2<span class="sc">$</span>id))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Create 4 temporary df's to store values from each iteration</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df2_mr<span class="ot">=</span>df2[<span class="dv">1</span><span class="sc">:</span>n_p,] <span class="co">#-&gt; for money_relative</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>df2_mnr<span class="ot">=</span>df2[(n_p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n_p<span class="sc">*</span><span class="dv">2</span>),] <span class="co">#-&gt;for money_nonrelative</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>df2_tr<span class="ot">=</span>df2[(<span class="dv">2</span><span class="sc">*</span>n_p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n_p<span class="sc">*</span><span class="dv">3</span>),] <span class="co">#-&gt;for time_relative</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>df2_tnr<span class="ot">=</span>df2[(<span class="dv">3</span><span class="sc">*</span>n_p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n_p<span class="sc">*</span><span class="dv">4</span>),] <span class="co">#-&gt;for time_nonrel</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#run discount wrapper for each subject in 2*2 conditions</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">unique</span>(df2<span class="sc">$</span>id)){</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#money relative</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  d_mon_rel<span class="ot">=</span>og_lng2<span class="sc">%&gt;%</span><span class="fu">filter</span>(id<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"money"</span>, kinship<span class="sc">==</span><span class="st">"rel"</span>) <span class="co">#-&gt; create temp df to get values from</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  df2_mr[df2_mr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'donation'</span>]<span class="ot">=</span><span class="st">"money"</span> <span class="co">#-&gt; store the appropriate donation</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  df2_mr[df2_mr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'kinship'</span>]<span class="ot">=</span><span class="st">"rel"</span> <span class="co">#-&gt; store the appropriate kinship</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co">#-&gt; define discount wrapper to get V, k, and RMSE values for this                                                      condition</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_mon_rel<span class="sc">$</span>soc_dist, </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_mon_rel<span class="sc">$</span>amount))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  opt1<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>)) <span class="co">#-&gt; run discount_wrapper</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  df2_mr[df2_mr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'k'</span>]<span class="ot">=</span>opt1<span class="sc">$</span>par[<span class="dv">2</span>] <span class="co">#-&gt; store resulting k_value</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  df2_mr[df2_mr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'V'</span>]<span class="ot">=</span>opt1<span class="sc">$</span>par[<span class="dv">1</span>] <span class="co">#-&gt; store resulting V_value</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get AUC value - using WolframAlpha, the integral of this discount function is:</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># V/k*ln(abs(1+k*n))+c -&gt; we don't really care about c for AUC.</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span>opt1<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  V<span class="ot">=</span>opt1<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Evaluate for upper bound</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  up<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  lower<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">0</span>))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>  df2_mr[df2_mr<span class="sc">$</span>id<span class="sc">==</span>i,<span class="st">'AUC'</span>]<span class="ot">=</span>up<span class="sc">-</span>lower</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co">#money nonrelative</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  d_mon_nonrel<span class="ot">=</span>og_lng2<span class="sc">%&gt;%</span><span class="fu">filter</span>(id<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"money"</span>, kinship<span class="sc">==</span><span class="st">"nonrel"</span>) </span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  df2_mnr[df2_mnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'donation'</span>]<span class="ot">=</span><span class="st">"money"</span> </span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  df2_mnr[df2_mnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'kinship'</span>]<span class="ot">=</span><span class="st">"nonrel"</span> </span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_mon_nonrel<span class="sc">$</span>soc_dist, </span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_mon_nonrel<span class="sc">$</span>amount))</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>  opt2<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>)) </span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>  df2_mnr[df2_mnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'k'</span>]<span class="ot">=</span>opt2<span class="sc">$</span>par[<span class="dv">2</span>] </span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>  df2_mnr[df2_mnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'V'</span>]<span class="ot">=</span>opt2<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get AUC value </span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span>opt2<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>  V<span class="ot">=</span>opt2<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Evaluate for upper bound</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>  up<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>  lower<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">0</span>))</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>  df2_mnr[df2_mnr<span class="sc">$</span>id<span class="sc">==</span>i,<span class="st">'AUC'</span>]<span class="ot">=</span>up<span class="sc">-</span>lower</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="co">#time relative</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>  d_time_rel<span class="ot">=</span>og_lng2<span class="sc">%&gt;%</span><span class="fu">filter</span>(id<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"time"</span>, kinship<span class="sc">==</span><span class="st">"rel"</span>)</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>  df2_tr[df2_tr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'donation'</span>]<span class="ot">=</span><span class="st">"time"</span> </span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>  df2_tr[df2_tr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'kinship'</span>]<span class="ot">=</span><span class="st">"rel"</span> </span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_time_rel<span class="sc">$</span>soc_dist, </span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_time_rel<span class="sc">$</span>amount))</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>  opt3<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>)) </span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>  df2_tr[df2_tr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'k'</span>]<span class="ot">=</span>opt3<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>  df2_tr[df2_tr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'V'</span>]<span class="ot">=</span>opt3<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get AUC value </span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span>opt3<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>  V<span class="ot">=</span>opt3<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Evaluate for upper bound</span></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>  up<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>  lower<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">0</span>))</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>  df2_tr[df2_tr<span class="sc">$</span>id<span class="sc">==</span>i,<span class="st">'AUC'</span>]<span class="ot">=</span>up<span class="sc">-</span>lower</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a><span class="co">#time nonrelative</span></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>  d_time_nonrel<span class="ot">=</span>og_lng2<span class="sc">%&gt;%</span><span class="fu">filter</span>(id<span class="sc">==</span>i, donation<span class="sc">==</span><span class="st">"time"</span>, kinship<span class="sc">==</span><span class="st">"nonrel"</span>)</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  df2_tnr[df2_tnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'donation'</span>]<span class="ot">=</span><span class="st">"time"</span> </span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>  df2_tnr[df2_tnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'kinship'</span>]<span class="ot">=</span><span class="st">"nonrel"</span> </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>  optim_discount_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data_vs_discount</span>(<span class="at">V =</span> x[<span class="dv">1</span>], <span class="at">k =</span> x[<span class="dv">2</span>],  </span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N =</span> d_time_nonrel<span class="sc">$</span>soc_dist, </span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> d_time_nonrel<span class="sc">$</span>amount))</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>  opt4<span class="ot">=</span><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.2</span>), optim_discount_wrapper, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">100</span>)) </span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>  df2_tnr[df2_tnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'k'</span>]<span class="ot">=</span>opt4<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>  df2_tnr[df2_tnr<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'V'</span>]<span class="ot">=</span>opt4<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get AUC value </span></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span>opt4<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>  V<span class="ot">=</span>opt4<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Evaluate for upper bound</span></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>  up<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>  lower<span class="ot">=</span>V<span class="sc">/</span>k<span class="sc">*</span><span class="fu">log</span>(<span class="fu">abs</span>(<span class="dv">1</span><span class="sc">+</span>k<span class="sc">*</span><span class="dv">0</span>))</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>  df2_tnr[df2_tnr<span class="sc">$</span>id<span class="sc">==</span>i,<span class="st">'AUC'</span>]<span class="ot">=</span>up<span class="sc">-</span>lower</span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine all into one dataframe (df2)</span></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>df2<span class="ot">=</span><span class="fu">full_join</span>(df2_mr, df2_mnr)<span class="sc">%&gt;%</span><span class="fu">full_join</span>(df2_tr)<span class="sc">%&gt;%</span><span class="fu">full_join</span>(df2_tnr)</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>df2_plot_pred<span class="ot">=</span>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="10" type="1">
<li>Exclude participants whose data does not fit hyperbolic discount function</li>
<li>Normalise individual k and AUC values via natural log transformation</li>
<li>Exclude individuals with transformed values that exceed ±3 SDs</li>
<li>Correlational analyses on demographic variables and transformed individual k/AUC values</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#recode all NaN AUC values as missing data (NA)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(df2<span class="sc">$</span>id)){</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.nan</span>(df2<span class="sc">$</span>AUC[i])){df2<span class="sc">$</span>AUC[i]<span class="ot">=</span><span class="cn">NA</span>}<span class="cf">else</span>{df2<span class="sc">$</span>AUC[i]<span class="ot">=</span>df2<span class="sc">$</span>AUC[i]}</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Negative or zero AUC or k values (indicating a problem with the fitting process)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>AUC<span class="ot">=</span><span class="fu">recode</span>(df2<span class="sc">$</span>AUC, <span class="st">"lo:0.01=NA"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>k<span class="ot">=</span><span class="fu">recode</span>(df2<span class="sc">$</span>k, <span class="st">"lo:0.01=NA"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#check if AUC is normally distributed</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>AUc_hist<span class="ot">=</span><span class="fu">ggplot</span>(<span class="at">data=</span>df2, <span class="fu">aes</span>(<span class="at">x=</span>AUC))<span class="sc">+</span><span class="fu">geom_histogram</span>() <span class="co">#-&gt; strong positive skew</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>logAUC_hist<span class="ot">=</span><span class="fu">ggplot</span>(<span class="at">data =</span> df2, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(AUC)))<span class="sc">+</span><span class="fu">geom_histogram</span>() <span class="co">#-&gt; looks better</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#check if k is normally distributed</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>k_hist<span class="ot">=</span><span class="fu">ggplot</span>(<span class="at">data=</span>df2, <span class="fu">aes</span>(<span class="at">x=</span>k))<span class="sc">+</span><span class="fu">geom_histogram</span>() <span class="co">#-&gt; strong positive skew</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>log_k_hist<span class="ot">=</span><span class="fu">ggplot</span>(<span class="at">data =</span> df2, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(k)))<span class="sc">+</span><span class="fu">geom_histogram</span>() <span class="co">#-&gt; looks better</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Since Gong et al., used log(AUC) and log(k) for their analysis, I shall do the same</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>logAUC<span class="ot">=</span><span class="fu">log</span>(df2<span class="sc">$</span>AUC)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>log_k<span class="ot">=</span><span class="fu">log</span>(df2<span class="sc">$</span>k)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#compute +/- 3 S.D for logAUC and log_k values</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>logAUC_hi<span class="ot">=</span><span class="fu">mean</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm=</span>T)<span class="sc">+</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm =</span> T))</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>logAUC_lo<span class="ot">=</span><span class="fu">mean</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm=</span>T)<span class="sc">-</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm =</span> T))</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>log_k_hi<span class="ot">=</span><span class="fu">mean</span>(df2<span class="sc">$</span>log_k, <span class="at">na.rm=</span>T)<span class="sc">+</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm =</span> T))</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>log_k_lo<span class="ot">=</span><span class="fu">mean</span>(df2<span class="sc">$</span>log_k, <span class="at">na.rm=</span>T)<span class="sc">-</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(df2<span class="sc">$</span>logAUC, <span class="at">na.rm =</span> T))</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co">#df2=df2%&gt;%filter(k&lt;=(mean(k)+3*sd(k)) &amp; k&gt;=(mean(k)-3*sd(k)) &amp; AUC&lt;=(mean(AUC)+3*sd(AUC))&amp; AUC&gt;=(mean(AUC)-3*sd(AUC))) #-&gt; retain only observations that meet criteria</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="co">#recode all observations outside of the +/- 3 S.D range as missing values</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>logAUC[df2<span class="sc">$</span>logAUC<span class="sc">&lt;</span>logAUC_lo]<span class="ot">=</span><span class="cn">NA</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>logAUC[df2<span class="sc">$</span>logAUC<span class="sc">&gt;</span>logAUC_hi]<span class="ot">=</span><span class="cn">NA</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>log_k[df2<span class="sc">$</span>log_k<span class="sc">&lt;</span>log_k_lo]<span class="ot">=</span><span class="cn">NA</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>log_k[df2<span class="sc">$</span>log_k<span class="sc">&gt;</span>log_k_hi]<span class="ot">=</span><span class="cn">NA</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="co">#check that the minimal values are not lower than k and AUC "_low"'s, and maximal not higher than "_high"'s</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(df2<span class="sc">$</span>log_k, <span class="at">na.rm =</span> T)<span class="sc">&lt;</span>log_k_lo; <span class="fu">max</span>(df2<span class="sc">$</span>log_k,<span class="at">na.rm =</span> T)<span class="sc">&gt;</span>log_k_hi; <span class="fu">min</span>(df2<span class="sc">$</span>logAUC,<span class="at">na.rm =</span> T)<span class="sc">&lt;</span>logAUC_lo; <span class="fu">max</span>(df2<span class="sc">$</span>logAUC,<span class="at">na.rm =</span> T)<span class="sc">&gt;</span>logAUC_hi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Change id to factor</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(df2<span class="sc">$</span>id) <span class="co">#-&gt; true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>id<span class="ot">=</span><span class="fu">as.character</span>(df2<span class="sc">$</span>id); df2<span class="sc">$</span>id<span class="ot">=</span><span class="fu">as.factor</span>(df2<span class="sc">$</span>id)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(df2<span class="sc">$</span>id)<span class="co">#-&gt; true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df2<span class="sc">$</span>age_group); <span class="fu">summary</span>(df2<span class="sc">$</span>donation); <span class="fu">summary</span>(df2<span class="sc">$</span>kinship) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>younger   older 
    296     248 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
      544 character character </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
      544 character character </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check that predictors are factors and AUC is numeric</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(df2<span class="sc">$</span>age_group); <span class="fu">is.factor</span>(df2<span class="sc">$</span>donation); <span class="fu">is.factor</span>(df2<span class="sc">$</span>kinship) <span class="co">#-&gt; age_group yes, others no</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(df2<span class="sc">$</span>donation)<span class="co">#-&gt; true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>donation<span class="ot">=</span><span class="fu">as.factor</span>(df2<span class="sc">$</span>donation); <span class="fu">is.factor</span>(df2<span class="sc">$</span>donation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(df2<span class="sc">$</span>kinship)<span class="co">#-&gt; true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>kinship<span class="ot">=</span><span class="fu">as.factor</span>(df2<span class="sc">$</span>kinship); <span class="fu">is.factor</span>(df2<span class="sc">$</span>kinship)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(df2<span class="sc">$</span>logAUC)<span class="co">#-&gt; True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove all observations of subjects with outliers</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>na_counts<span class="ot">=</span>df2<span class="sc">%&gt;%</span><span class="fu">group_by</span>(id)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">naAUC_counts=</span><span class="fu">sum</span>(<span class="fu">is.na</span>(logAUC)),<span class="at">na_k_counts=</span><span class="fu">sum</span>(<span class="fu">is.na</span>(log_k)))<span class="sc">%&gt;%</span><span class="fu">ungroup</span>()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(df2<span class="sc">$</span>id)){</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">filter</span>(na_counts, id<span class="sc">==</span>i)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'naAUC_counts'</span>]<span class="ot">=</span>temp<span class="sc">$</span>naAUC_counts</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  df2[df2<span class="sc">$</span>id<span class="sc">==</span>i, <span class="st">'na_k_counts'</span>]<span class="ot">=</span>temp<span class="sc">$</span>na_k_counts</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>df2_noNA_AUC<span class="ot">=</span>df2<span class="sc">%&gt;%</span><span class="fu">filter</span>(naAUC_counts<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>df2_noNA_k<span class="ot">=</span>df2<span class="sc">%&gt;%</span><span class="fu">filter</span>(na_k_counts<span class="sc">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confirmatory-analysis" class="level3">
<h3 class="anchored" data-anchor-id="confirmatory-analysis">Confirmatory analysis</h3>
<ol type="1">
<li>2 (age: younger vs older) × 2 (donation form: money vs time) × 2 (kinship: relatives vs non-relatives) mixed design, repeated measures ANOVA of transformed individual AUC values, with demographic variables as control + post-hoc tests if applicable (<strong>key analysis of interest</strong>)</li>
<li>2 (age: younger vs older) × 2 (donation form: money vs time) × 2 (kinship: relatives vs non-relatives) mixed design, repeated measures ANOVA of transformed individual AUC values, without demographic variables as control + post-hoc tests if applicable</li>
<li>2 (age: younger vs older) × 2 (donation form: money vs time) × 2 (kinship: relatives vs non-relatives) mixed design, repeated measures ANOVA of transformed individual k values, with demographic variables as control + post-hoc tests if applicable</li>
<li>2 (age: younger vs older) × 2 (donation form: money vs time) × 2 (kinship: relatives vs non-relatives) mixed design, repeated measures ANOVA of transformed individual k values, without demographic variables as control + post-hoc tests if applicable</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#preparing the datasets for ANOVA by removing missing values (updated to include education and income)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>df2_noNA_AUC <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df2_noNA_AUC[, <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"logAUC"</span>, <span class="st">"important_family"</span>, <span class="st">"important_friends"</span>, <span class="st">"donation"</span>, <span class="st">"kinship"</span>, <span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"education"</span>, <span class="st">"income"</span>)])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>df2_noNA_k <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df2_noNA_k[, <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"log_k"</span>, <span class="st">"important_family"</span>, <span class="st">"important_friends"</span>, <span class="st">"donation"</span>, <span class="st">"kinship"</span>, <span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"education"</span>, <span class="st">"income"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC without covariates</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>anova_AUC1<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_AUC, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(logAUC), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_AUC1<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 35%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">1.2336057</td>
<td style="text-align: right;">0.2690857</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0069667</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">42.4995862</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0528351</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">133.1895202</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.1720180</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">0.1233329</td>
<td style="text-align: right;">0.7261072</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0001619</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">3.3290225</td>
<td style="text-align: right;">0.0707329</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0051928</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">10.8717450</td>
<td style="text-align: right;">0.0013088</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0030717</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">6.0558879</td>
<td style="text-align: right;">0.0153863</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0017163</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC with gender, number of important family members, and number of important friends as covariates</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>anova_AUC2<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_AUC, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(logAUC), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">between_covariates =</span> .(gender, important_family, important_friends) ,<span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_AUC2<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 35%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">1.5106072</td>
<td style="text-align: right;">0.2216225</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0084787</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">42.4995862</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0531637</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">133.1895202</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.1729524</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">0.1233329</td>
<td style="text-align: right;">0.7261072</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0001629</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">3.3290225</td>
<td style="text-align: right;">0.0707329</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0052269</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">10.8717450</td>
<td style="text-align: right;">0.0013088</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0030918</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">6.0558879</td>
<td style="text-align: right;">0.0153863</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0017276</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC with education, income, and number of important friends as covariates</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>anova_AUC2<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_AUC, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(logAUC), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">between_covariates =</span> .(education, income, important_friends) ,<span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_AUC2<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 35%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">0.1865793</td>
<td style="text-align: right;">0.6666095</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0010394</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">42.4995862</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0548476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">133.1895202</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.1777183</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">0.1233329</td>
<td style="text-align: right;">0.7261072</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0001684</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">3.3290225</td>
<td style="text-align: right;">0.0707329</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0054020</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">10.8717450</td>
<td style="text-align: right;">0.0013088</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0031951</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">6.0558879</td>
<td style="text-align: right;">0.0153863</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0017855</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#k value without covariates</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>anova_k1<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_k, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(log_k), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_k1<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 36%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.0193905</td>
<td style="text-align: right;">0.8894824</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0000975</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">9.5479500</td>
<td style="text-align: right;">0.0024799</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0086659</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">29.4591287</td>
<td style="text-align: right;">0.0000003</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0457469</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.9273779</td>
<td style="text-align: right;">0.1675754</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0017646</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.2799433</td>
<td style="text-align: right;">0.5976997</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0004556</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">2.0189688</td>
<td style="text-align: right;">0.1578955</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0012108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.0013225</td>
<td style="text-align: right;">0.3189713</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0006012</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#k value with gender, number of important family members, and number of important friends as covariates</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>anova_k2<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_k, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(log_k), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">between_covariates =</span> .(gender, important_family, important_friends) ,<span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_k2<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 36%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.0036504</td>
<td style="text-align: right;">0.9519211</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0000182</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">9.5479500</td>
<td style="text-align: right;">0.0024799</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0088133</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">29.4591287</td>
<td style="text-align: right;">0.0000003</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0464956</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.9273779</td>
<td style="text-align: right;">0.1675754</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0017949</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.2799433</td>
<td style="text-align: right;">0.5976997</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0004634</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">2.0189688</td>
<td style="text-align: right;">0.1578955</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0012315</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.0013225</td>
<td style="text-align: right;">0.3189713</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0006115</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#k value with education, income, and number of important friends as covariates</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>anova_k2<span class="ot">=</span><span class="fu">ezANOVA</span>(<span class="at">data =</span> df2_noNA_k, <span class="at">wid=</span>.(id), <span class="at">dv=</span><span class="fu">na.omit</span>(log_k), <span class="at">within  =</span> .(donation, kinship), <span class="at">between =</span> .(age_group), <span class="at">between_covariates =</span> .(education, income, important_friends) ,<span class="at">type =</span> <span class="dv">3</span>, <span class="at">observed =</span> .(age_group))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(anova_k2<span class="sc">$</span>ANOVA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 36%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Effect</th>
<th style="text-align: right;">DFn</th>
<th style="text-align: right;">DFd</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">p&lt;.05</th>
<th style="text-align: right;">ges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.2484529</td>
<td style="text-align: right;">0.6190640</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0012320</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">9.5479500</td>
<td style="text-align: right;">0.0024799</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0088332</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">29.4591287</td>
<td style="text-align: right;">0.0000003</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.0465966</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">age_group:donation</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.9273779</td>
<td style="text-align: right;">0.1675754</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0017990</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">age_group:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.2799433</td>
<td style="text-align: right;">0.5976997</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0004644</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">2.0189688</td>
<td style="text-align: right;">0.1578955</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0012343</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">age_group:donation:kinship</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">1.0013225</td>
<td style="text-align: right;">0.3189713</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0006129</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualisation" class="level3">
<h3 class="anchored" data-anchor-id="visualisation">Visualisation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set data to create similar median amounts plots to the one appearing in the original paper</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>med_table_plot<span class="ot">=</span>med_table2<span class="sc">%&gt;%</span><span class="fu">unite</span>(<span class="st">'Age-Kinship'</span>, <span class="fu">c</span>(<span class="st">'age_group'</span>, <span class="st">'kinship'</span>), <span class="at">sep=</span><span class="st">" - "</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> med_table_plot, <span class="fu">aes</span>(<span class="at">x =</span> soc_dist, <span class="at">y =</span> med_amnt, <span class="at">color =</span> <span class="st">`</span><span class="at">Age-Kinship</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="fu">aes</span>(<span class="at">shape =</span> <span class="st">`</span><span class="at">Age-Kinship</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"nls"</span>, <span class="at">formula =</span> y <span class="sc">~</span> a <span class="sc">/</span> (b <span class="sc">+</span> x), </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">100</span>, <span class="at">b =</span> <span class="dv">10</span>)), </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(donation <span class="sc">~</span> ., <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">donation =</span> <span class="fu">c</span>(<span class="st">"money"</span> <span class="ot">=</span> <span class="st">"Money (x $1000 USD)"</span>, <span class="st">"time"</span> <span class="ot">=</span> <span class="st">"Time (x days)"</span>))) <span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Closeness"</span>) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Median amount donated"</span>) <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exploratory-analyses" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-analyses">Exploratory analyses</h3>
<p>I was interested in testing differences between age groups on demographic variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>gender_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>gender, df<span class="sc">$</span>age_group)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(gender_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Non-binary"</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Gender x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(df<span class="sc">$</span>gender, df<span class="sc">$</span>age_group)) <span class="co">#significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  table(df$gender, df$age_group)
X-squared = 6.7646, df = 2, p-value = 0.03397</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>education_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>education, df<span class="sc">$</span>age_group)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(education_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Middle school"</span>, <span class="st">"High school"</span>, <span class="st">"Some college"</span>, <span class="st">"Bachelor's degree"</span>, <span class="st">"Graduate degree"</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Education x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(education <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  education by age_group
t = -1.7487, df = 133.95, p-value = 0.08263
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -0.5165006  0.0317578
sample estimates:
mean in group younger   mean in group older 
             3.918919              4.161290 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>income_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>income, df<span class="sc">$</span>age_group)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(income_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"0-30k"</span>, <span class="st">"30-60k"</span>, <span class="st">"60-90k"</span>, <span class="st">"90-120k"</span>, <span class="st">"120-150k"</span>, <span class="st">"150k+"</span>),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Income x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(income <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  income by age_group
t = -1.1343, df = 124.09, p-value = 0.2589
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -0.8017096  0.2175771
sample estimates:
mean in group younger   mean in group older 
             3.175676              3.467742 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>income_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>important_friends, df<span class="sc">$</span>age_group)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(income_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Number of important friends x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(important_friends <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  important_friends by age_group
t = 0.24713, df = 126.96, p-value = 0.8052
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -1.078263  1.386022
sample estimates:
mean in group younger   mean in group older 
             4.621622              4.467742 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>income_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>important_family, df<span class="sc">$</span>age_group)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(income_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Number of important family x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(important_family <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  important_family by age_group
t = -1.4941, df = 126.69, p-value = 0.1376
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -3.1087422  0.4339384
sample estimates:
mean in group younger   mean in group older 
             5.243243              6.580645 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>income_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>easeM, df<span class="sc">$</span>age_group)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(income_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Ease of earning money x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(easeM <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  easeM by age_group
t = 0.75284, df = 133.43, p-value = 0.4529
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -0.2007470  0.4474776
sample estimates:
mean in group younger   mean in group older 
             2.445946              2.322581 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>income_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>easeT, df<span class="sc">$</span>age_group)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(income_table, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Ease of getting time off x Age"</span>, <span class="at">xlab =</span> <span class="st">"Age Group"</span>, <span class="at">ylab =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-30-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(easeT <span class="sc">~</span> age_group, <span class="at">data =</span> df) <span class="co">#not significantly different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  easeT by age_group
t = -1.2649, df = 125.4, p-value = 0.2083
alternative hypothesis: true difference in means between group younger and group older is not equal to 0
95 percent confidence interval:
 -0.6428274  0.1415197
sample estimates:
mean in group younger   mean in group older 
             2.878378              3.129032 </code></pre>
</div>
</div>
<p>Interestingly, the age groups were statistically equivalent across all demographic variables except gender. This suggests that the lack of a main effect of age was not driven by age-related differences in other demographic factors.</p>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
</section>
<section id="mini-meta-analysis" class="level2">
<h2 class="anchored" data-anchor-id="mini-meta-analysis">Mini meta analysis</h2>
<p>I was not able to conduct a mini meta-analysis because the key analysis of interest was the main effect of age in a mixed design ANOVA. The effect size measure obtainable was partial eta-squared and there was no real way for me to convert this to Cohen’s d (largely due to differences in group sizes within each of the studies). Additionally, no other attempts to replicate this study other than those conducted for this class were found.</p>
<p>However, I will note here that effect size of the main effect of age varied considerably in each incarnation of this study: in the original study partial eta-squared was 0.05, in the first replication attempt it was 0.025, and in this study it was between 0.001 and 0.01 depending on whether and which covariates were included in analyses.</p>
<p>In the original study, the main effect of age on AUC value was F(1,134) = 6.52, p &lt; .05. In the first replication attempt, the main effect effect of age on AUC value was F(1,70) = 1.66, p = .20. In the the current replication rescue attempt, the main effect effect of age on AUC value was F(1,113) = 0.24, p = .62.</p>
<section id="summary-of-replication-attempt" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-replication-attempt">Summary of Replication Attempt</h3>
<p>Overall, it is fair to say this replication attempt was not successful. Across multiple ANOVAs with or without two different combinations of covariates, and irrespective of the measure of donation willingness used as the dependent variable (i.e., AUC or k values), the main effect of age was consistently far from statistically significant. Therefore, I would give this rescue attempt a rating of 0 in terms of how well it replicated the original study’s reuslts.</p>
<p>Interestingly, however, donation type and kinship emerged as robust predictors of donation willingness across all analyses. Visualisation of the data revealed that participants, regardless of age, were significantly more willing to donate <em>time</em> over <em>money</em>, and to donate to <em>relatives</em> over <em>non-relatives</em>. This suggests that, at least among this sample, donation type and kinship may be much more important predictors of generosity than age.</p>
<p>Perhaps even more interestingly, in the original study, Gong and colleagues did not find any main effect of donation type or kinship. However, in the first replication attempt, Shavit actually found main effects of donation type and kinship in the same directions as the current rescue project. Accordingly, though the findings of the current project essentially did not converge with the original study in any way, they actually served to replicate and corroborate the findings of the first replication attempt: there was no significant main effect of age, but there were significant main effects of donation type and kinship.</p>
</section>
<section id="commentary" class="level3">
<h3 class="anchored" data-anchor-id="commentary">Commentary</h3>
<p>The main way in which this project attempted to shed light on the first replication attempt’s failure to replicate the original study’s findings was by sampling a new set of individuals <em>whose cultural backgrounds more closely aligned with the participants in the original study</em>. Although this was not a perfect, or even ideal, test of the role of culture in moderating the complex relationship between donation willingness and age, kinship, and donation form - we cannot assume that the experiences and values of Hong Kong Chinese are comparable to those of Prolific workers who identify as East Asian - it does suggest that the effect found in the original study may have been specific to the Hong Kong Chinese context.</p>
<p>An important caveat to this study’s findings is that the participants in the older group here were <em>considerably younger</em> than the participants in both the original study and the first replication attempt. Here, we elected to lower the age limit for participation as part of the older adult group in order to recruit a sufficient number of older East Asian participants on Prolific, and, in this way, to prioritise investigating the influence of culture. Nonetheless, this is a meaningful way in which this rescue attempt diverged from the studies it followed.</p>
<p>As a final aside, it was interesting to see how powerful <em>educational attainment</em> and <em>household income</em> - both of which can be considered facets of socioeconomic status (SES) - were in explaining variance in donation willingness when included in the analyses as covariates. This suggests that these factors may be considerably more important than age in shaping generosity towards close others, at least among English-speaking samples. This is perhaps unsurprising as - even though the donation task was purely hypothetical - higher SES seems intuitively likely to be associated with higher rates of engaging in donation behaviour. Perhaps the more money people have to spare, the easier it is for them to imagine wanting to share their money and time with the people they care about in times of need.</p>
</section>
</section>
<section id="supplementary-image" class="level2">
<h2 class="anchored" data-anchor-id="supplementary-image">Supplementary Image</h2>
<p>(added by VB for effect direction estimation)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2_noNA_AUC, <span class="fu">aes</span>(<span class="at">x=</span>age_group, <span class="at">y=</span>logAUC,<span class="at">color=</span>age_group))<span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position=</span><span class="st">"jitter"</span>,<span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set1"</span>)<span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom=</span><span class="st">"bar"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>, <span class="at">geom=</span><span class="st">"pointrange"</span>, <span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_pointrange(data=mean_and_ci, aes(y=mean,ymin = ci_lower, ymax = ci_upper),color = "black",size=0.7, alpha=0.6)+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>()<span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mean AUC values by age group, donation type, and kinship"</span>)<span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"AUC values (log transformed)"</span>)<span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age group"</span>)<span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(donation<span class="sc">~</span>kinship)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Replication-Report-Template_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>